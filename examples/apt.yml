- name: Add an Apt signing key (Debian)
  apt_key:
    url: https://packagecloud.io/gpg.key
    state: present
  
- name: Ensure requirements are installed (Debian)
  apt:
    name: "{{ item }}"
    state: latest
  with_items:
    - debian-archive-keyring
    - apt-transport-https
    
- name: Ensure repository configuration (Debian)
  apt_repository: >
    repo={{ item }}
    state=present
    filename=github_git-lfs
    update_cache=yes
    mode=0644
  with_items:
    - "deb https://packagecloud.io/github/git-lfs/{{ansible_distribution|lower}}/ {{ansible_distribution_release}} main"
- "deb-src https://packagecloud.io/github/git-lfs/{{ansible_distribution|lower}}/ {{ansible_distribution_release}} main"

- name: Ensure github git-lfs is installed (Debian)
  apt:
    name=git-lfs={{ git_lfs_version }}
    state=present

- name: Install the cockpit packages for OS Debian
  apt: 
   name: {{ item }} 
   state: installed
  loop:
   - "{{ list_with_pkgs }}"
  when: ansible_os_family == 'Debian'

- name: Update apt cache.
  apt: update_cache=yes cache_valid_time=86400

- name: Ensure PHP packages are installed.
  apt:
    name: "{{ php_packages }}"
    state: "{{ php_packages_state }}"
    install_recommends: "{{ php_install_recommends }}"
  register: php_package_install
  notify: restart webserver